 <!doctype html>
<html lang="en">
  <head>

    <script>
      const set_session_token = async () => {
        const userId = "2527";
        const tokenKey = "session_token_" + userId;
        const session_expire_key = "session_expire_" + userId;
        // check localstorage.session already exists and not expired
        if (localStorage.getItem(session_expire_key) && localStorage.getItem(session_expire_key) > Date.now()/1000) {
            console.log('devrev token exists and not expired')
            return localStorage.getItem(tokenKey);
        }

        const response = await fetch("/devrev/token/" + userId, {
          method: 'GET',
          headers: {
              'Content-Type': 'application/json'
          },
        })
        const data = await response.json();
        localStorage.setItem(tokenKey, data.access_token);
        localStorage.setItem(session_expire_key, data.expires_in);
        return data.access_token;
      }

  </script>
    <!-- Sentry instrumentation start -->
    <script
      src="https://browser.sentry-cdn.com/7.54.0/bundle.tracing.replay.min.js"
      integrity="sha384-8wl63sykJEt5wJGcyNxwRPnLlRq8LtOMYzWhhRmdZS2PeYLAkgr8ILtC5ns+akjI"
      crossorigin="anonymous"
    ></script>

    <script>
      Sentry.init({
        dsn: 'https://ba057145e7ae48bca2d48999be06393e@sentry.ihoa.link/2',
        environment: "staging",
        integrations: [new Sentry.BrowserTracing()],
        tracesSampleRate: 1.0,
        enableTracing: true,
        autoSessionTracking: true,
        
      initialScope: {
        user: {id: "2527", email: "qaadmin@inspecthoa.com"},
      },
      
      });
    </script>
    <!-- Sentry instrumentation end -->

    <script>
      function openPopup(url) {
        const width = 1024;
        const height = 768;
        // Specify the popup window features
        const left = (screen.availWidth - width) / 2;
        const top = (screen.availHeight - height) / 2;
        const popupFeatures = `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`;

        // Open the link in a popup window
        window.open(url, "_blank", popupFeatures, "noopener,noreferrer");

        return false; // Prevent the default link behavior
      }

      const convertToIST = (timestamp) => {
          // Append 'Z' to indicate that the timestamp is in UTC
          const utcTimestamp = timestamp + 'Z';
          const date = new Date(utcTimestamp).toLocaleString("en-US", {
              hour12: false,
              timeZone: "Asia/Kolkata"
          });
          return `${date} IST`;
      }


    // Convert timestamp to EST (Eastern Standard Time)
    const convertToEST = (timestamp) => {
      const utcTimestamp = timestamp + 'Z';
        const date =  new Date(utcTimestamp).toLocaleString("en-US", {hour12: false, timeZone: "America/New_York" });
        return `${date} EST`;
    }

    const calculateTimeDifference = (timestamp, timezone) => {
        const utcTimestamp = moment.utc(timestamp);
        const currentTime = moment().utcOffset(getTimeZoneOffset(timezone));
        const diffInMilliseconds = currentTime.diff(utcTimestamp);
        const diffInMinutes = Math.floor(diffInMilliseconds / (1000 * 60));
        const diffInHours = Math.floor(diffInMilliseconds / (1000 * 60 * 60));
        const diffInDays = Math.floor(diffInMilliseconds / (1000 * 60 * 60 * 24));

        if (diffInHours < 1) {
            return `${diffInMinutes} minutes ago`;
        } else if (diffInHours < 24) {
            return `${diffInHours} hours ago`;
        } else {
            return `${diffInDays} days ago`;
        }
    };
    const getTimeZoneOffset = (timezone) => {
        const timezones = {
            "Asia/Kolkata": 330,
            "America/New_York": -300,
        };
        return timezones[timezone] || 0;
    };

    var updateTimestamps = (timezone) => {
    $(".date-timestamp").each(function() {
        var originalTimestamp = $(this).data("original-value");
        var originalTitle = $(this).data("constant-title");
        //var isIST = $(this).hasClass("ist-timestamp");
        var convertedTimestamp;
        if (!originalTimestamp || originalTimestamp === "None"){
            $(this).text("");
            if (!originalTitle){
              $(this).attr("title", "");
            }
            return; // Continue to the next iteration
        }
        let timezoneString;
        if (timezone === "IST") {
            convertedTimestamp = convertToIST(originalTimestamp);
            timezoneString = "Asia/Kolkata";
            // Toggle active state for IST button
            $("#ist-button").addClass("active-tz-button").removeClass("inactive-tz-button");
            $("#est-button").addClass("inactive-tz-button").removeClass("active-tz-button");
        } else if (timezone === "EST") {
            convertedTimestamp = convertToEST(originalTimestamp);
            timezoneString = "America/New_York";
            // Toggle active state for EST button
            $("#est-button").addClass("active-tz-button").removeClass("inactive-tz-button");
            $("#ist-button").addClass("inactive-tz-button").removeClass("active-tz-button");
        }

        $(this).text(convertedTimestamp);
        const timeDifference = calculateTimeDifference(originalTimestamp, timezoneString);
        $(this).attr("title", originalTitle || timeDifference);
        // if (!originalTitle){
        //   $(this).attr("title", moment(originalTimestamp).fromNow());
        // }else{
        //   $(this).attr("title", originalTitle);
        // }
    });

    // Store the selected timezone in localStorage
    localStorage.setItem('selectedTimezone', timezone);
};
    </script>



    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="https://ihoa-workflow-flask-assets-staging.s3.amazonaws.com/static/favicon.ico"
      type="image/x-icon"
    />

    <title>
       
      1234 Wilshire Blvd, Los Angeles, AL 90017  
    </title>

    
    <link rel="stylesheet" href="https://ihoa-workflow-flask-assets-staging.s3.amazonaws.com/static/gen/packed.css?fb1ddbc6" />
      
    <script type="text/javascript" src="https://ihoa-workflow-flask-assets-staging.s3.amazonaws.com/static/gen/first.js?a0256b4b"></script>
     
    <script type="text/javascript" src="https://ihoa-workflow-flask-assets-staging.s3.amazonaws.com/static/gen/packed.js?e1f18a91" async></script>
    
  </head>

  <body
    class="hold-transition "
    hx-ext="loading-states"
  >
    <div class="wrapper">
      <script>
       const initChatPlugin = () => {
            set_session_token().then(token => {
                window.plugSDK.init({
                    app_id: "don:core:dvrv-us-1:devo/tmD9r4ID:plug_setting/1",
                    session_token: token
                });
            }).catch(error => {
                console.error("Failed to initialize chat plugin:", error);
            });
        }

        document.addEventListener("DOMContentLoaded", initChatPlugin);
    </script>
        <!-- Navbar -->
<nav class="main-header navbar navbar-expand navbar-white navbar-light">
  <!-- Left navbar links -->
  <ul class="navbar-nav">
    <li class="nav-item" onclick="sideBarToggle()">
      <a class="nav-link" href="#" role="button"
        ><i class="fas fa-bars"></i
      ></a>
    </li>
    <li class="nav-item d-none d-sm-inline-block">
      <a href="/" class="nav-link">Home</a>
    </li>

    
    
    <li class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle"
        href="#"
        id="navbarDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Dashboard
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown">
        <a class="dropdown-item" href="/tableau_dashboard">Tableau Dashboard</a>
        <a class="dropdown-item" href="/assignment/availability-dashboard">Availability Dashboard</a>
        <a class="dropdown-item" href="/orders_no_property">Order-Prop Dashboard</a>
        <a class="dropdown-item" href="/devops_dashboard">Devops Dashboard</a>
        <a class="dropdown-item" href="/csm">ClientMessages</a>
        
        <a class="dropdown-item" href="/po-csm">PO messages</a>
        
        <a class="dropdown-item" href="/post_closing_dashboard">Post Closing Dashboard</a>
        <a class="dropdown-item" href="/seller_pay_first_dashboard">Pay First Dashboard</a>
        <a class="dropdown-item" href="/merged_invoices_dashboard">Monthly Invoices</a>
        <a class="dropdown-item" href="/order_invoice_page">Order Invoice</a>
        <a class="dropdown-item" href="/clients_page">Clients Page</a>
        <a class="dropdown-item" href="/users_page">Users Page</a>
        <a class="dropdown-item" href="/invalid_addresses_dashboard">Invalid Addresses Dashboard</a>
        
        <a class="dropdown-item" href="/special_handling_dashboard">Special Handling Dashboard</a>
        
        <a class="dropdown-item" href="/invoice_issues_dashboard">Invoice Issues Dashboard</a>
        <a class="dropdown-item" href="/fresh_emails_prop_link_dashboard">Orphaned Emails </a>
        <a class="dropdown-item" href="/list_outgoing_email_logs">Outgoing Email Logs </a>
        
          <a class="dropdown-item" href="/caller/caller_scripts_dashboard">Caller Scripts Dashboard</a>
        

      </div>
    </li>
    




    <li class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle"
        href="#"
        id="navbarDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Attention
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown">
        <a class="dropdown-item" href="/rush_orders_dashboard">Rush Orders Dashboard</a>
      </div>
    </li>

    <li class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle"
        href="#"
        id="navbarDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Customers
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown">
        <a class="dropdown-item" href="/clients_page">Clients Page</a>
        <a class="dropdown-item" href="/client_teams_page">Client Teams Page</a>
        <a class="dropdown-item" href="/users_page">Users Page</a>
        <a class="dropdown-item" href="/campaign/nps">NPS Campaign</a>
        <a class="dropdown-item" href="/pricing/active">Pricing Matrix</a>
        
        <a class="dropdown-item" href="/special_handling_dashboard">Special Handling Dashboard</a>
        

      </div>
    </li>


    <li class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle"
        href="#"
        id="navbarDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Tasks
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown">
        <a class="dropdown-item" href="/mytasks"
          >My Tasks</a
        >
        <a class="dropdown-item" href="/assigned_tasks"
          >Assigned Tasks</a
        >
        <div class="dropdown-divider"></div>
        <a
          class="dropdown-item"
          href="/task_summary/8"
          >Task Summary</a
        >
      </div>
    </li>

    

    <li class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle"
        href="#"
        id="navbarDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Admin
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown">
        <a href="/admin/hoa" class="dropdown-item">Reference Data</a>
        <a href="/admin_user" class="dropdown-item">Admin User Page</a>
      </div>
    </li>

    

    

    <li class="nav-item d-none d-sm-inline-block">
      <a class="nav-item nav-link" href="/property/new">+Property</a>
    </li>

    


    <li class="nav-item d-none d-sm-inline-block">
      <a class="nav-item nav-link" href="/account">Account</a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a class="nav-item nav-link logoutLink" href="/logout">Logout</a>
    </li>

    



  </ul>


  <!-- Right navbar links -->
  <ul class="navbar-nav ml-auto">
    <!-- SEARCH BAR (FUZZY SEARCH PROPERTY) -->
    <button id="user-clock-out" class="btn mr-5 btn-outline-danger btn-sm  d-none ">
      <i class="fa fa-clock"></i> Clock out
    </button>
    <button id="user-clock-in" class="btn mr-5 btn-outline-success btn-sm ">
      <i class="fa fa-clock"></i> Clock in
    </button>


    <li class="nav-item">
      <div class="navbar-search-block">
        <form class="form-inline" action="/fuzzy_search" method="POST">
          <div class="input-group input-group-sm">
            <input class="form-control form-control-navbar" type="search" name="fuzzy_search_text" placeholder="Search by Property Name" aria-label="Sea1rch">
            <div class="input-group-append">
              <button class="btn btn-navbar" type="submit">
                <i class="fas fa-search"></i>
              </button>
              <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <input type="hidden" name="form_type" value="fuzzy_search">
        </form>
      </div>
    </li>






    <!-- Notifications Dropdown Menu -->
    <li class="nav-item dropdown">
      <a class="nav-link" data-toggle="dropdown" href="#">
        <i class="far fa-bell"></i>
        <span class="badge badge-warning navbar-badge">0</span>
      </a>
      <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
        <span class="dropdown-header"> 0 Tasks</span>
        <div class="dropdown-divider"></div>
        <a href="/mytasks" class="dropdown-item">
          <i class="fas fa-envelope mr-2"></i> 0 pending tasks
        </a>
        <!-- <a href="#" class="dropdown-item">
          <i class="fas fa-envelope mr-2"></i> 4 new messages
          <span class="float-right text-muted text-sm">3 mins</span>
        </a> -->

      </div>
    </li>
  </ul>
</nav>
<!-- /.navbar -->


<script>
  const sideBarToggle = () => {
    const body = document.querySelector("body");
    const currentClass = body.className;

    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    if (isMobile) {
      if (body.classList.contains('sidebar-collapse')) {
      body.className = 'sidebar-mini sidebar-open sidebar-is-opened';
      // after 3 seconds remove the class
      setTimeout(() => {
        body.className = 'sidebar-mini sidebar-closed sidebar-collapse';
      }, 3000);

    } else {
      body.className = 'sidebar-mini sidebar-closed sidebar-collapse';
    }
      }
     else {


    if (body.classList.contains('sidebar-collapse')) {
      body.className = 'sidebar-mini sidebar-is-opened';
    } else {
      body.className = 'sidebar-mini sidebar-collapse';
    }
    }


  }
</script>


<script>
  $(document).ready(function () {

    const clock_in_btn = document.getElementById("user-clock-in");
    const clock_out_btn = document.getElementById("user-clock-out");
    const STATUS_NO_CONTENT = 204
    const STATUS_INTERNAL_ERROR = 500
    const STATUS_FORBIDDEN = 403
    clock_in_btn.addEventListener("click", ()=>{
      sweet_alert("info", "Clocking in...")
      fetch(`/assignment/clock-in`, {
            method: "POST",
            body: {},
          })
          .then(function (response) {
            return response.json();
          })
          .then((data) => {
            if(data.status == STATUS_NO_CONTENT){
              sweet_alert('success', 'Game on for qaadmin!')
              clock_in_btn.classList.toggle("d-none");
              clock_out_btn.classList.toggle("d-none");
            } else if(data.status == STATUS_FORBIDDEN){
              login_page_url = `/login`
              window.location.href = login_page_url

            }else{
              sweet_alert('error', 'There was an error clocking in. Please contact engineering team!')
            }
          })
          .catch(function (err) {
            sweet_alert('error', 'There was an error clocking in. Please contact engineering team!')
          });
    })

    clock_out_btn.addEventListener("click", ()=>{
      sweet_alert("info", "Clocking out...")
      fetch(`/assignment/clock-out`, {
            method: "POST",
            body: {},
          })
          .then(function (response) {
            return response.json();
          })
          .then((data) => {
            if(data.status == STATUS_NO_CONTENT){
              sweet_alert('success', 'See you later qaadmin!')
              clock_in_btn.classList.toggle("d-none");
              clock_out_btn.classList.toggle("d-none");
            }else{
              sweet_alert('error', 'There was an error clocking out. Please contact engineering team!')
            }
          })
          .catch(function (err) {
            sweet_alert('error', 'There was an error clocking out. Please contact engineering team!')
          });
    })


  })
</script>

       <!-- Main Sidebar Container -->

<style>
  li.show-dropdown > ul {
    display: block !important;
  }

  .sub-active {
    color: #c2c7d0;
    background: #464e55;
  }

  .sub-active-tree {
    position: relative;
    left: 20px;
    width: 91%;
  }

  #sidebar_aside_tag {
    background-color: white !important;
    color: black;
  }
  .togglehelperclass a {
    color: black !important;
  }

  .selected_page,
  .togglehelperclass a:hover {
    color: black !important;
    background-color: #24a18e !important;
    /* background-image: linear-gradient(to right, rgb(36, 161, 142, 1), rgb(22, 73, 81, 0)); */
  }
</style>

<aside
  id="sidebar_aside_tag"
  class="main-sidebar sidebar-dark-primary elevation-4"
  style="position: fixed; max-height: calc(100vh - 9rem); overflow-y: auto"
>
  <a
    href="/"
    class="brand-link d-flex justify-content-center align-items-cente"
  >
    <img
      src="https://ihoa-workflow-flask-assets-staging.s3.amazonaws.com/static/img/logo.svg"
      alt="Logo"
      class="brand-image"
      style="opacity: 0.8"
    />
    <span class="brand-text font-weight-light"> &nbsp;</span>
  </a>

  <!-- Sidebar -->
  <div class="sidebar">
    <!-- Sidebar Menu -->
    <nav class="mt-2">
      <ul
        class="nav nav-pills nav-sidebar flex-column"
        data-widget="treeview"
        role="menu"
        data-accordion="false"
      >
        <li
          class="nav-item togglehelperclass"
          id="ref-to-property-overview-section"
          name="ref-to-property-overview-section"
          onclick="window.open('/property/340482/200031', '_self')"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-laptop-house"></i>
            <p>Property</p>
          </a>
        </li>

        <!-- Order Overview -->
        
        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/ordersnew/340482/200031', '_self')"
          name="ref-to-order-overview-section"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-shopping-cart"></i>
            <p>Order</p>
          </a>
        </li>

        <!-- Lender Review -->
        
        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/lender_review/340482/200031', '_self')"
          name="ref-to-lender-review-section"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-question-circle"></i>
            <p>Lender Review</p>
          </a>
        </li>
        

        <!-- Client comments -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/client_comments/340482/200031', '_self')"
          name="ref-to-client-messages"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-comment"></i>
            <p>Client Comments</p>
          </a>
        </li>

        <!-- Followups -->

        <li
          class="nav-item togglehelperclass"
          name="ref-to-order-followups"
          onclick="window.open('/shipping/340482/200031', '_self')"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-shipping-fast"></i>
            <p>Shipping</p>
          </a>
        </li>

        <!-- Followups -->

        <li
          class="nav-item togglehelperclass"
          name="ref-to-property-mailbox"
          onclick="window.open('/mailbox_home/340482/200031', '_self')"
          
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-envelope"></i>
            <p>
              MailBox
              <span
                class="badge badge-danger font-weight-bold ml-2"
                data-toggle="tooltip"
                data-placement="top"
                title="Unread email count"
                id="unread_email_count_sidebar_badge"
              >
                0
              </span>
              <span
                class="badge badge-warning font-weight-bold ml-2"
                data-toggle="tooltip"
                data-placement="top"
                title="Unread fax count"
                id="unread_fax_count_sidebar_badge"
              >
                0
              </span>
            </p>
          </a>
        </li>

        

        <li
          class="nav-item togglehelperclass"
          name="ref-to-sms-dashboard"
          onclick="window.open('/sms/340482/200031', '_self')"
          
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon far fa-comment"></i>
            <p>SMS</p>
          </a>
        </li>

        <li
          class="nav-item togglehelperclass"
          name="ref-to-phone-dashboard"
          onclick="window.open('/phone/340482/200031', '_self')"
          
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-phone"></i>
            <p>Phone</p>
          </a>
        </li>

        <!-- Invocing -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/invoice/340482/200031', '_self')"
          name="ref-to-order-invoicing"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-file-invoice-dollar"></i>
            <p>Invoicing</p>
             
            <span
              style="margin-left:5px; height: 5px; width: 5px; background: #2bff07; border-radius: 50%; display: inline-block;"
            >
            </span>
            
          </a>
        </li>

        <!-- Liens -->
        

        <!-- Document section -->
        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/documents/340482/200031', '_self')"
          name="ref-to-document-section"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-file"></i>
            <p>Document Section</p>
          </a>
        </li>

        

        <!-- Chat -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/teamchat/340482/200031', '_self')"
          name="ref-to-team-chat"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-comments"></i>
            <p>Team Chat</p>
            <span
              class="badge badge-danger font-weight-bold ml-2"
              data-toggle="tooltip"
              data-placement="top"
              title="Open task(s)"
              id="unread_email_count_sidebar_badge"
            >
              13
            </span>
          </a>
        </li>

        <!-- FILES INFO SECTION -->
        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/files/340482/200031', '_self')"
          name="ref-to-files-section"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-file-upload"></i>
            <p>Files</p>
          </a>
        </li>

        <!-- FINDER SECTION -->

        <li
          class="nav-item togglehelperclass "
          name="ref-to-finder-section"
        >
          <a
            href="#"
            class="nav-link has_dropdown "
          >
            <i class="nav-icon fas fa-search-location"></i>
            <p>Finder</p>
            
          </a>

          <ul class="nav nav-treeview" style="margin-bottom: -41px">
            <li
              class="nav-item togglehelperclass sub-active-tree"
              onclick="window.open('/finder/340482/200031', '_self')"
              name="ref-to-finder-section"
            >
              <a
                href="javascript:void(0)"
                class="nav-link "
              >
                
                <p>HOA and Plat Data</p>
              </a>
            </li>

            <li
              class="nav-item togglehelperclass sub-active-tree"
              onclick="window.open('/finder/checklists/340482/200031', '_self')"
              
              name="ref-to-finder-checklist-section"
            >
              <a
                href="javascript:void(0)"
                class="nav-link "
              >
                
                <p>Checkpoint Finders</p>
              </a>
            </li>
          </ul>
        </li>

        <!--  CALLER SECTION   -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/caller/340482/200031', '_self')"
          name="ref-to-review-caller-data"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="fas fa-phone-alt nav-icon"></i>
            <p>Caller</p>
          </a>
        </li>

        <!-- CHECKER SECTION -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/checker/340482/200031', '_self')"
          name="ref-to-review-checker-data"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="fas fa-check-circle nav-icon"></i>
            <p>Checker</p>
          </a>
        </li>

        <!-- BYLAWS SECTION -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/bylaw/340482/200031', '_self')"
          name="ref-to-review-bylaw-data"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="fas fa-gavel nav-icon"></i>
            <p>Bylaw</p>
            
            <i
              class="fas fa-check text-black ml-2"
              data-toggle="tooltip"
              data-placement="top"
              title="Agent IRIS(Bylaws) run completed"
            ></i>
            
          </a>
        </li>

        <!-- FINANCE -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/finance/340482/200031', '_self')"
          name="ref-to-review-finance-data"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="fas fa-hand-holding-usd nav-icon"></i>
            <p>Finance</p>
          </a>
        </li>

        
        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/access/340482/200031', '_self')"
          name="ref-to-review-access-data"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="fas fa-address-card nav-icon"></i>
            <p>Access</p>
          </a>
        </li>
        

        <!-- PROPERTY STATUS CHANGE -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/change_status/340482/200031', '_self')"
          name="ref-to-change-property-status"
        >
          <a
            href="#"
            class="nav-link  selected_page "
          >
            <i class="nav-icon fas fa-tasks"></i>
            <p>Change Status</p>
          </a>
        </li>

        

        <!-- HOA PAYMENTS -->

        

        <!-- LINKS -->

        <li
          class="nav-item togglehelperclass"
          onclick="window.open('/links/340482/200031', '_self')"
          name="ref-to-links"
        >
          <a
            href="#"
            class="nav-link "
          >
            <i class="nav-icon fas fa-network-wired"></i>
            <p>Links</p>
          </a>
        </li>
      </ul>
    </nav>
    <!-- /.sidebar-menu -->
  </div>
  <!-- /.sidebar -->
</aside> 
      

   
<div class="modal fade bd-example-modal-xl" id="orderChecksModal" tabindex="-1" role="dialog"
    aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">

            <div class="modal-header d-flex justify-content-center">
                <div style="text-align: center;">
                    <h2 class="modal-title">Order Checkpoints</h2>
                    <h5>Check all checkboxes and then click on Agree</h5>
                </div>
            </div>
            <div class="modal-body">

                <!-- Client Comments -->
                <div class="card card-secondary w-100 mb-3">
                    <div class="card-header secondary-card-header w-100">
                        <h3 class="card-title text-left">Client Comments
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                style="margin-left: 12px; transform: scale(1.5); width: 12px; height: 12px;">
                        </h3>
                    </div>
                    <table class="table w-100" style="margin-bottom: 0;">
                        <thead>
                            <tr>
                                <th style="display: flex; justify-content: space-between; align-items: center;">
                                </th>
                            </tr>
                        </thead>
                        <tbody id="client-comments-table"></tbody>
                    </table>
                </div>
                <!-- Client name -->
                <div class="card card-secondary w-100 mb-3">
                    <div class="card-header secondary-card-header w-100">
                        <h3 class="card-title text-left">Client Name
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                style="margin-left: 12px; transform: scale(1.5); width: 12px; height: 12px;">
                        </h3>
                    </div>
                    <table class="table w-100" style="margin-bottom: 0;">
                        <tbody>
                            <tr>
                                <td style="width: 100%;">
                                    QA Client (qaclient@inspecthoa.com)
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Client Uploaded Files -->
                <div class="card card-secondary w-100 mb-3">
                    <div class="card-header secondary-card-header w-100">
                        <h3 class="card-title text-left">Client Uploaded Files
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                style="margin-left: 12px; transform: scale(1.5); width: 12px; height: 12px;">
                        </h3>
                    </div>
                    <table class="table w-100" style="margin-bottom: 0;">
                        <thead>
                            <tr>
                                <th style="display: flex; justify-content: space-between; align-items: center;">
                                </th>
                            </tr>
                        </thead>
                        <tbody id="client-uploaded-files-table"></tbody>
                    </table>
                </div>

                <!-- Documents & Services Status  -->
                <div class="card card-secondary w-100 mb-3">
                    <div class="card-header secondary-card-header w-100">
                        <h3 class="card-title text-left">Documents & Services Status
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                style="margin-left: 12px; transform: scale(1.5); width: 12px; height: 12px;">
                        </h3>
                    </div>
                    <div class="d-flex justify-content-between" style="margin-left:20px; margin-top:10px;">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                                    aria-controls="home" aria-selected="true">HOA</a>
                            </li>
                            
                            
                        </ul>
                    </div>
                    <!-- Tab Content -->
                    <div class="tab-content" id="myTabContent">
                        <!-- Primary HOA Tab Content -->
                        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                            <div class="card card-secondary w-100 mb-3">
                                <table class="table w-100" style="margin-bottom: 0;">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%;">Document Name</th>
                                            <th style="width: 50%;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="document-type-dict"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Master HOA Tab Content -->
                        <div class="tab-pane fade" id="master" role="tabpanel" aria-labelledby="master-tab">
                            <div class="card card-secondary w-100 mb-3">
                                <table class="table w-100" style="margin-bottom: 0;">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%;">Document Name</th>
                                            <th style="width: 50%;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="master-document-type-dict"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- HOA 3 Tab Content -->
                        <div class="tab-pane fade" id="hoa3" role="tabpanel" aria-labelledby="hoa3-tab">
                            <div class="card card-secondary w-100 mb-3">
                                <table class="table w-100" style="margin-bottom: 0;">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%;">Document Name</th>
                                            <th style="width: 50%;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="hoa3-document-type-dict"></tbody>
                                </table>
                            </div>
                        </div>


                        <div class="card card-secondary w-100 mb-3">
                            <div class="card-header secondary-card-header w-100">
                                <h3 class="card-title text-left">Client Special Handling
                                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                        style="margin-left: 12px; transform: scale(1.5); width: 12px; height: 12px;">
                                </h3>
                            </div>

                            <div style="overflow-x: auto;">
                                <table class="table w-100" style="margin-bottom: 0;">
                                    <thead>
                                        <tr>
                                            <th
                                                style="display: flex; justify-content: space-between; align-items: center;">
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="width: 100%;">
                                                testing
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success" id="agreeButton" disabled>Agree</button>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    var myModal = new bootstrap.Modal(document.getElementById('orderChecksModal'), {
        backdrop: 'static',  // Prevents closing when clicking outside the modal
        keyboard: false //prevents closing
    });
    document.addEventListener('DOMContentLoaded', () => {
        const po_checks_acknowledged = true;
        const is_FPO_Team = false; //check if user is from FPO team
        const is_admin = true; //check if user is admin
        const is_analyst = true; //check if user is analyst
        // check if the user is from FPO team, is an analyst but not admin
        if (!po_checks_acknowledged && is_FPO_Team && !is_admin && is_analyst) {
            get_document_status_dict();
        }
        else {
            return;
        }
    });
    const orderDocumentTypeEnum = {
        0: "Not Ordered",  // OrderDocumentTypeEnum.NotOrdered
        1: "Ordered",      // OrderDocumentTypeEnum.Ordered
        2: "Received",     // OrderDocumentTypeEnum.Received
        3: "Not Available",// OrderDocumentTypeEnum.NotAvailable
        4: "Found Free",   // OrderDocumentTypeEnum.FoundFree
        5: "Unknown Status"// Default case
    };
    const get_document_status_dict = () => {
        fetch("/get/document/status/200031")
        .then(response => response.json())
        .then(data => {
            console.log(data);
            const document_status_dict = data.document_status_dict;
            const client_comments = data.client_comments;
            const client_uploaded_files = data.client_uploaded_files;
            generateDocumentRows(document_status_dict['document_type_dict'], 'document-type-dict');
            generateDocumentRows(document_status_dict['hoa_3_document_type_dict'], 'hoa3-document-type-dict');
            generateDocumentRows(document_status_dict['master_document_type_dict'], 'master-document-type-dict');
            const client_comments_table = document.getElementById('client-comments-table');
            client_comments.forEach(comment => {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.classList.add('bg-gradient-primary');
                td.style.width = '100%';
                const div = document.createElement('div');
                div.style.borderColor = '#007bff';
                div.style.color = 'white';
                div.style.width = '100%';
                div.innerHTML = comment; // Safely insert
                td.appendChild(div);
                tr.appendChild(td);
                client_comments_table.appendChild(tr);
            });
            const client_uploaded_files_table = document.getElementById('client-uploaded-files-table');
            client_uploaded_files.forEach(file => {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.style.width = '100%';
                const div = document.createElement('div');
                div.style.width = '100%';
                const a = document.createElement('a');
                a.href = `/properties/viewpdf?key=${file}`; // Assuming this is the URL format
                a.target = '_blank';
                a.textContent = file;
                div.appendChild(a);
                td.appendChild(div);
                tr.appendChild(td);
                client_uploaded_files_table.appendChild(tr);
            });
            myModal.show();
        })
        .catch(error => {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Order Checkpoints could not be loaded',
            });
            console.error('Error:', error)
        });
    }
    function generateDocumentRows(documentStatusDict, tableId) {
        if (documentStatusDict) {
            const table = document.getElementById(tableId);
            Object.entries(documentStatusDict).forEach(([documentShowName, documentInfo]) => {
                const tr = document.createElement('tr');

                const td1 = document.createElement('td');
                td1.style.width = '50%';
                td1.textContent = documentShowName;

                const td2 = document.createElement('td');
                td2.style.width = '50%';
                const status = orderDocumentTypeEnum[documentInfo["document_status"]] || orderDocumentTypeEnum[5]; // Default to "Unknown Status"
                td2.textContent = status;

                tr.appendChild(td1);
                tr.appendChild(td2);
                table.appendChild(tr);
            });
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const orderId = 200031;
    const agreeButton = document.getElementById('agreeButton');

    function areAllCheckboxesChecked() {
        const checkboxes = document.querySelectorAll('#orderChecksModal .form-check-input');
        return Array.from(checkboxes).every(checkbox => checkbox.checked);
    }

    function updateAgreeButtonState() {
        if (areAllCheckboxesChecked()) {
            agreeButton.removeAttribute('disabled');
        } else {
            agreeButton.setAttribute('disabled', 'disabled');
        }
    }

    const checkboxes = document.querySelectorAll('#orderChecksModal .form-check-input');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateAgreeButtonState);
    });

    document.getElementById('agreeButton').addEventListener('click', () => {
        const allChecked = areAllCheckboxesChecked();

        if (allChecked) {
            fetch("/order_checks", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    order_id: orderId,
                    all_checkboxes_checked: true
                })
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('Request failed with status ' + response.status);
                }
            })
            .then(data => {
                myModal.hide();
                Swal.fire({
                    icon: 'success',
                    title: 'Order Checks Acknowledged',
                    text: 'You have successfully acknowledged the order checks.',
                });

                fetch("/provisionPhoneNumberOrderChecks/200031", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    }
                })
                .then(() => {
                    window.location.reload();
                })
                .catch(error => {
                    console.error("Phone number provision error:", error);
                });
            })
            .catch(error => {
                console.error("Error:", error);
            });

        } else {
            alert('Please check all checkboxes before proceeding.');
            console.log('Not all checkboxes are checked. Request aborted.');
        }
    });

    updateAgreeButtonState();
    });
</script>

<div class="content-wrapper">
  
  
  

  

  
  
  
  
  
  
  
  
  
  
  
  

  <style>
    .timezone-button{
        border: none;
        font-size: small;
    }

    .active-tz-button{
      background-color: #f98e80;
    }
    .inactive-tz-button{
      background-color: #f5c6bf;
    }


    .small-box {
      display: flex;
      flex-direction: column;
      height: 100%; /* This ensures that the child takes the full height of the parent */
      border-radius: 4px !important;
    }

    .small-box-footer {
      margin-top: auto; /* pushes the footer to the bottom */
    }

    .sticky-header-properties{
        position: fixed;
        top: 0;
        z-index: 1035;
        background-color: white;
        box-shadow: rgba(0, 0, 0, 0.15) 0px 15px 25px, rgba(0, 0, 0, 0.05) 0px 5px 10px;
        width: calc(100% - 250px); /* 250px is the width of the sidebar */
    }

  </style>

<div id="property-sticky-info-filler"></div>
<div id="property-sticky-info" class="content-header">
    <div class="container-fluid">


       <div class="row mb-0">
          <div class="col-sm-12">
                    <style>
                        .vertical-line {
                            border-left: 3px solid #dfdfdf;
                        }

                        .text-success {
                            color: #24a18e!important;
                        }
                        .warning-text{
                            color:rgb(252, 144, 130);
                        }
                    </style>

                    <div class="d-flex  justify-content-between align-items-center mb-2 ml-2">

                        <h1 class="m-0 text-info" id="content-header-address-full">
                            <a class="text-success" href="None "> 1234 Wilshire Blvd, Los Angeles, AL 90017</a>
                        </h1>
                        
                        <div style="display: flex;">
                            
                                <div style="margin-top: 20px;">
                                    <div hx-get="/mini-progress-bar/200031" hx-trigger="load">
                                        <div class="loader-overlay w-100" style="height:70px; padding: 5px;">
                                            <div class="spinner"></div>
                                        </div>
                                    </div>
                                </div>
                            

                            <div class="d-flex align-items-center" style="gap: 20px; margin-left: 20px;">
                                
                                <div style="background-color: #24a18e;">
                                    <h5 class="text-white font-weight-bold p-2 px-4 m-0">HOA Documents</h5>
                                </div>
                                

                                <div id="help-guide"
                                    onclick="window.open('https://wiki.inspecthoa.com/en/Workflow_Help/Status')"
                                >
                                    <i class="fas fa-question-circle"></i>&nbsp;Help
                                </div>
                            </div>
                        </div>

                    </div>

                    
                    <div class="d-flex flex-row mr-0 mb-0">

                        <div class="col-lg-3 col-3 flex-fill">

                            <div class="small-box bg-white mr-3 mb-0">
                                <div class="inner">
                                    <h5 ><b>testing</b> </h5>
                                    <div class="hide-on-scroll">
                                        <span class=" text-center "  ><b>Order:</b> 200031</span> <br>
                                        <span class=" text-center "  ><b>Client Team:</b> test-sub2</span> <br>

                                        <span
                                            hx-trigger="load"
                                            hx-get="/order_user_info/200031"
                                            hx-target="#clientUserInfoDiv"
                                            hx-swap="outerHTML"
                                            hx-indicator="#clientUserInfoDiv"
                                        ></span>


                                        <div id="clientUserInfoDiv"></div>

                                        
                                            <span class="text-center">&nbsp;</span><br>
                                        
                                        <span class=" text-center "  >
                                            
                                        </span>

                                    <a href="#" class="small-box-footer"> </a>
                                </div>
                            </div>
                            </div>
                        </div>


                        <div class="col-lg-3 col-3 flex-fill">
                            <div class="small-box bg-white mr-3 mb-0">
                                <div class="inner">
                                    <h5>
                                        
                                        <b>
                                          
                                            HOA DOCUMENTS
                                          
                                        </b>
                                        
                                        
                                    </h5>
                                    <div class="hide-on-scroll">
                                    <span class=" text-center "  ><b>Origin:</b>
                                        
                                            Client Portal
                                        
                                    </span> <br>
                                    <span class=" text-center "  ><b>Rush:</b> </span>
                                    <span id="order-rush-status" class="text-center">
                                        No
                                    </span> <br>

                                    <span class=" text-center "  ><b>Trial:</b> </span>
                                    
                                        <span class=" text-center "  > No </span> <br>
                                    

                                    
                                        <span class=" text-center "  ><b>Prepayment:</b> </span>

                                        
                                            <span class=" text-center"> No</span> <br>
                                        
                                    

                                <a href="#" class="small-box-footer"> </a>
                                </div>
                            </div>
                        </div>
                        </div>

                        <div class="col-lg-3 col-3 flex-fill">

                            <div class="small-box bg-white mr-3 mb-0">
                                <div class="inner">
                                    <h5 id="general-property-order-status-value"><b>
                                         
                                           IN PROGRESS
                                          </b>  </h5>

                                    <div class="hide-on-scroll">
                                    <span class=" text-center " ><b>Submitted:</b> 12/23/2024</span> <br>
                                    <span class=" text-center " ><b >Due:</b></span>
                                    <span class=" text-center warning-text" > <b> <span id='due-date'>2024-11-15 </span></b></span> <br>

                                    
                                    <span class=" text-center "  ><b>Closing: </b><span id="closing-date">2024-11-16</span> </span> <br>
                                    
                                    
                                    <span class=" text-center "  ><b>ETA:</b> <span id="eta-date">2024-12-05 </span></span> <br>
                                    
                                    
                                <a href="#" class="small-box-footer"> </a>
                            </div>

                            </div>
                        </div>
                        </div>

                        <div class="col-lg-3 col-3 flex-fill">
                            <div class="small-box bg-white mr-3 mb-0">
                                <div class="inner">
                                    <div class="d-flex mb-1">
                                        <h5 class="mb-0 mr-2"><b>ACTIVITY</b></h5>

                                        <!-- KOUSSAY WORK HERE :koussayhacker: -->
                                        <div>
                                            <button class="timezone-button active-tz-button" id="ist-button">IST</button>
                                            <button class="timezone-button inactive-tz-button" id="est-button">EST</button>
                                        </div>

                                    </div>
                                    <div class="hide-on-scroll">
                                  
                                  
                                  
                                  
                                  


                                  
                                  
                                  
                                  

                                  
                                  
                                  
                                  

                                  <span class="">
                                    <span class="text-center timestamp">
                                        <b>Last CC Received:</b>
                                    </span>
                                    <span class="date-timestamp ist-timestamp" id="last-message-received-date" data-original-value="2025-01-14 13:05:59">
                                        2025-01-14 13:05:59
                                    </span>
                                    <br>
                                </span>

                                <span class="hide">
                                    <span class="text-center timestamp">
                                        <b>Email Sent:</b>
                                    </span>
                                    <span class="date-timestamp ist-timestamp" id="email-sent-date" data-original-value="None">
                                        None
                                    </span>
                                    <br>
                                </span>

                                <span class="">
                                    <span class="text-center timestamp">
                                        <b>Email Received:</b>
                                    </span>
                                    <span class="date-timestamp ist-timestamp" id="email-received-date" data-original-value="2024-11-21 13:05:56.923000">
                                        2024-11-21 13:05:56.923000
                                    </span>
                                    <br>
                                </span>

                                <span class="">
                                    <span class="text-center timestamp">
                                        <b>Last Call:</b>
                                    </span>
                                    <span class="date-timestamp ist-timestamp" id="last-call-date" data-original-value="2025-01-06 12:27:09.217000">
                                        2025-01-06 12:27:09.217000
                                    </span>
                                    <br>
                                </span>
                                <a href="#" class="small-box-footer"> </a>
                                </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        
                        <div class="alert alert-warning alert-dismissible fade mt-3 ml-1" role="alert" style="width: 98%; display: none; background-color: #ffc107;" id="auto-email-alert">
                            <strong><i>An automatic email has been sent for this HOA. Do not send a new email. Monitor for a response.</i></strong>
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        
                    </div>
                

          </div>
       </div>

       <div
       role="alert"
       hx-trigger="load"
       hx-swap="outerHTML"
       hx-get="/client_warning_message/200031"
       >
        </div>
 </div>

 <script>

    function checkAutomatedEmailStatus(orderId) {
        fetch(`/auto/email/alert/${orderId}`)
        .then(response => response.json())
        .then(data => {
            if (data.is_automate_mail_sent) {
                var alertElement = document.getElementById('auto-email-alert');
                alertElement.classList.add('show');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    window.addEventListener("load", function() {
        checkAutomatedEmailStatus(parseInt("200031"));
    });

    const formatDate = (dateString) => {
        // Converts "YYYY-MM-DD" to "MM/DD/YYYY"
        if (!dateString || dateString === "None") {
            return "None";
        }

        // Ensure dateString is in the correct format
        const parts = dateString.split('-');
        if (parts.length === 3) {
            return `${parts[1]}/${parts[2]}/${parts[0]}`;
        }

        // If the dateString is not in the expected format, return it as is
        return dateString;
            }

    const updateDate = (elementId) => {
        const element = document.getElementById(elementId);
        if (element && element.innerHTML.trim()) {
            element.innerHTML = formatDate(element.innerHTML.trim());
        }
    }

    const updateCicDueDate = () => {
        const cicEtaDateElement = document.getElementById("cic-eta-date");
        const cicDateElement = document.getElementById("cic-date");

        if (cicEtaDateElement && cicDateElement && cicEtaDateElement.innerHTML.trim()) {
            const cicEtaDate = formatDate(cicEtaDateElement.innerHTML.trim());
            const cicDate = formatDate(cicDateElement.innerHTML.trim());

            if (new Date(cicEtaDate) > new Date(cicDate)) {
                cicDateElement.innerHTML = cicEtaDate;
            }
        }
    }

    updateDate("due-date");
    updateDate("closing-date");
    updateDate("cic-date");
    updateDate("eta-date");
    updateDate("cic-eta-date");

    updateCicDueDate();
</script>


  <script>
      $(document).ready(function() {

            // Check localStorage for a saved timezone
            var savedTimezone = localStorage.getItem('selectedTimezone') || "IST";
            updateTimestamps(savedTimezone);

            $("#ist-button").on("click", () => {
                updateTimestamps("IST");
            });
            $("#est-button").on("click", () => {
                updateTimestamps("EST");
            });
      });

      function enlargeIcon(element) {
        element.style.transform = "scaleX(-1) scale(1.1)";
      }

      function resetIcon(element) {
        element.style.transform = "scaleX(-1)";
      }


    //   tooltip set html to true
    $(function () {
      $('[data-toggle="tooltip"]').tooltip({
        html: true
      })
    })

    // when scrolling, add a fixed element on top:0 saying: "Property page"
    $(document).ready(function() {
      $(window).scroll(function() {

        if ($(this).scrollTop() > 0) {
            $('#property-sticky-info').addClass('sticky-header-properties');
            $('.hide-on-scroll').hide();
            $('#property-sticky-info-filler').css('height', $('#property-sticky-info').height() + 50);

        } else{
            $('#property-sticky-info').removeClass('sticky-header-properties');
            $('.hide-on-scroll').show();
            $('#property-sticky-info-filler').css('height', 0);
        }
      });

    //   when clicking on the #property-sticky-info, expand the div to show the hidden elements
      $('#property-sticky-info').click(function() {
        $('.hide-on-scroll').show();
      });

      $("#start-w3-workflow-button").on("click", () => {
        console.log("clicked");
        const orderId = parseInt("200031");
        fetch(`/w3/workflow/start/${orderId}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            sweet_alert("success", "started w3 workflow");
        })
        .catch(error => {
            console.error('Error:', error);
            sweet_alert("error", "error in starting w3 workflow");
        });
      });

    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <section class="content">
    <div class="container-fluid">

        

        <!-- Tab Content -->
        <div class="tab-content pt-3" id="custom-tabs-one-tabContent">
            
           <div
           class="tab-pane fade show active"
           id="order-200031"
           role="tabpanel"
           aria-labelledby="order-200031"
           >
           
<section class="content">
  <div class="container-fluid">
  
    

<div id="accordion">
    <div class="card">
       <div class="card-header secondary-card-header accordion-header" id="accordion_heading">
          <button
             type="button"
             class="btn btn-accordion"
             data-toggle="collapse"
             data-target="#accordion_content"
             aria-expanded="true"
             aria-controls="accordion_content">
             <div class="d-flex justify-content-between" style="align-items: center">
                <span>Open Special Handling</span>
                <i class="animate-icon rotate fas fa-chevron-down"></i>
            </div>
          </button>
       </div>
       <div id="accordion_content" class="accordion-body collapse" aria-labelledby="accordion_heading" data-parent="#accordion">
          <div class="card-body">
            hi sh for testing<p dir="ltr" style="margin-top: 0pt; margin-bottom: 0pt; line-height: 1.38;"></p><span id="docs-internal-guid-5b7a5054-7fff-4e86-9de9-ebf5e2656bf2"><p dir="ltr" style="line-height:1.3800000000000001;margin-top:0pt;margin-bottom:0pt;"></p></span>
          </div>
       </div>
    </div>
</div>

  <script>
$(document).ready(function() {
    let closedAccordions = JSON.parse(sessionStorage.getItem('closedAccordions')) || [];
    let currentUrl = window.location.href;

    // Function to update button text based on accordion state
    function updateButtonText(isOpen) {
        let buttonText = isOpen ? 'Close Special Handling' : 'Open Special Handling';
        $('#accordion_heading button span').text(buttonText);
        let $arrow = $('#accordion_heading button .animate-icon rotate fas fa-chevron-down');

        if (isOpen) {
            $arrow.removeClass('rotate fas fa-chevron-down').addClass('rotate fas fa-chevron-down');
        } else {
            $arrow.removeClass('rotate fas fa-chevron-down').addClass('rotate fas fa-chevron-down');
        }
    }


    // Open accordion by default if URL not in the closedAccordions array
    if (!closedAccordions.includes(currentUrl)) {
        $('#accordion_content').addClass('show');
    }

    // Set initial button text
    updateButtonText($('#accordion_content').hasClass('show'));

    // Event listeners for accordion state changes
    $('#accordion_content').on('show.bs.collapse', function () {
        updateButtonText(true);
        let index = closedAccordions.indexOf(currentUrl);
        if (index > -1) {
            closedAccordions.splice(index, 1);
            sessionStorage.setItem('closedAccordions', JSON.stringify(closedAccordions));
        }
    });

    $('#accordion_content').on('hide.bs.collapse', function () {
        updateButtonText(false);
        if (!closedAccordions.includes(currentUrl)) {
            closedAccordions.push(currentUrl);
            sessionStorage.setItem('closedAccordions', JSON.stringify(closedAccordions));
        }
    });
});
  </script>
  
  <div class="card card-secondary">
      <div class="card-header secondary-card-header">
        <h3 class="card-title"> Change Status </h3>
      </div>
      <!-- /.card-header secondary-card-header -->
      <!-- form start -->

      <form class="form-horizontal" method="POST" id="changeStatusForm" action="/change_status">
        <div class="card-body">

          
          <div class="form-group row">
          

          <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="orderStatusDropdown">Order Status</label></label>

          
            <div class="col-sm-10">
              <select class="form-control status" id="orderStatusDropdown" name="orderStatusDropdown" value="1"><option value="-2">All</option><option value="-1">NONE</option><option selected value="0">NEW</option><option value="1">IN PROGRESS</option><option value="6">ESCALATED</option><option value="9">DOCUMENTS READY</option><option value="10">PROCESSING REPORT</option><option value="14">WAITING FOR CLIENT CONFIRMATION</option><option value="26">ADDITIONAL REQUESTS</option><option value="102">ON HOLD</option><option value="2">UNABLE TO COMPLETE</option><option value="3">CANCELLED</option><option value="5">DELETED</option><option value="13">HOA INFORMATION NOT FOUND</option><option value="12">INFORMATION NOT FOUND</option><option value="15">NON MANDATORY HOA FOUND</option><option value="16">HOME SALE CANCELLED</option><option value="11">NO HOA FOUND</option><option value="4">COMPLETE</option></select>
            </div>
          
          </div>

        <div class="form-group row mb-4" id="reason-block" >
          <label for="reason" class="col-sm-2 col-form-label form-control-label">Reason for Block</label>
          <div class="col-sm-10">
              <select class="form-control status" id="reason" name="reason">
                <option value="" selected>Select a reason</option>
                
                <option value="4">BUYER APPROVAL PENDING</option>
                
                <option value="6">BUYER OR SELLER DETAILS PENDING</option>
                
                <option value="9">CANCELLATION OF CONTRACT PENDING</option>
                
                <option value="2">CREDIT CARD DETAILS PENDING</option>
                
                <option value="5">DEED PENDING</option>
                
                <option value="11">HOA OR PM CONTACT DETAILS PENDING</option>
                
                <option value="0">NULL</option>
                
                <option value="7">ON HOLD</option>
                
                <option value="10">PAY FIRST INVOICE PAYMENT PENDING</option>
                
                <option value="8">RUSH APPROVAL PENDING</option>
                
                <option value="3">SELLER AUTHORIZATION PENDING</option>
                
                <option value="1">WET AUTHORIZATION PENDING</option>
                
              </select>
          </div>
        </div>
          
            <div class="form-group row" style="display: none;">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="fasubStatusDropdown">FA Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="fasubStatusDropdown" name="fasubStatusDropdown" value="None"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">FA NEW</option><option value="2">FA INPROGRESS</option><option value="3">FA UNABLE TO COMPLETE</option><option value="4">FA ANALYSIS COMPLETE</option><option value="5">FA HELP</option><option value="6">FA REASSIGNED</option><option value="7">FA ARCHIVE</option><option value="8">FA TL COMPLETE</option><option value="9">FA TL ARCHIVE</option><option value="10">FA REVIEW1 COMPLETE</option><option value="11">FA REVIEW2 COMPLETE</option><option value="12">FA TEAM LEAD CHECKED</option></select>
              </div>
            </div>
            

            
            <div class="form-group row">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="basubStatusDropdown">BA Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="basubStatusDropdown" name="basubStatusDropdown" value="12"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">BA NEW</option><option value="2">BA INPROGRESS</option><option value="3">BA UNABLE TO COMPLETE</option><option value="4">BA ANALYSIS COMPLETE</option><option value="5">BA HELP</option><option value="6">BA REASSIGNED</option><option value="7">BA ARCHIVE</option><option value="8">BA TL COMPLETE</option><option value="9">BA TL ARCHIVE</option><option value="10">BA REVIEW1 COMPLETE</option><option value="11">BA REVIEW2 COMPLETE</option><option value="12">BA TEAM LEAD CHECKED</option></select>
              </div>
            </div>
            

            

            
            <div class="form-group row">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="findersubStatusDropdown">Finder Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="findersubStatusDropdown" name="findersubStatusDropdown" value="12"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">FINDER NEW</option><option value="2">FINDER INPROGRESS</option><option value="4">FINDER ANALYSIS COMPLETE</option><option value="7">FINDER ARCHIVE</option><option value="12">FINDER TEAM LEAD CHECKED</option><option value="13">FINDER MASTER CONFIRM PENDING</option><option value="14">FINDER WAITING FOR DOC ORDER DETAILS</option></select>
              </div>
            </div>
            

            
            <div class="form-group row">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="callersubStatusDropdown">Caller Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="callersubStatusDropdown" name="callersubStatusDropdown" value="12"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">CALLER NEW</option><option value="2">CALLER INPROGRESS</option><option value="4">CALLER ANALYSIS COMPLETE</option><option value="5">CALLER PO</option><option value="7">CALLER ARCHIVE</option><option value="12">CALLER TEAM LEAD CHECKED</option><option value="13">CALLER WAITING FOR RESALE PACKAGE</option></select>
              </div>
            </div>
            

            
            <div class="form-group row">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="posubStatusDropdown">PO Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="posubStatusDropdown" name="posubStatusDropdown" value="4"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">PO NEW</option><option value="2">PO INPROGRESS</option><option value="4">PO ANALYSIS COMPLETE</option><option value="5">PO WAITING</option><option value="7">PO ARCHIVE</option><option value="12">PO TEAM LEAD CHECKED</option><option value="13">PO DOCS ORDERED</option></select>
              </div>
            </div>

            <div class="form-group row po_resume_date_div" style="display: none">
              <label for="pStatus" class="col-sm-2 col-form-label">PO Resume Date</label>
              <div class="col-sm-10">
                <input type="date" name="po_resume_date" id="po_resume_date" min="2025-01-15" class="form-control" value="None" >
              </div>
            </div>
            

            
            <div class="form-group row">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="doccheckersubStatusDropdown">DocChecker Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="doccheckersubStatusDropdown" name="doccheckersubStatusDropdown" value="2"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">DA NEW</option><option value="2">DA INPROGRESS</option><option value="4">DA ANALYSIS COMPLETE</option><option value="7">DA ARCHIVE</option><option value="10">DA REVIEW1 COMPLETE</option><option value="11">DA REVIEW2 COMPLETE</option><option value="12">DA TEAM LEAD CHECKED</option></select>
              </div>
            </div>
            


            
            <div class="form-group row">
              <label for="pStatus" class="col-sm-2 col-form-label"><label class="form-control-label" for="invoicingUserSubStatusDropdown">Invoicing Sub Status</label></label>
              <div class="col-sm-10">
                <select class="form-control status" id="invoicingUserSubStatusDropdown" name="invoicingUserSubStatusDropdown" value="12"><option selected value="-2">All</option><option value="-1">NONE</option><option value="1">IU NEW</option><option value="2">IU INPROGRESS</option><option value="4">IU ANALYSIS COMPLETE</option><option value="7">IU ARCHIVE</option><option value="12">IU TEAM LEAD CHECKED</option><option value="13">IU INVOICE INCORRECT</option><option value="14">INVOICE APPROVED EARLY</option></select>
              </div>
            </div>
            

          

        </div>
        <!-- /.card-body -->
        <div class="card-footer">
          <input type="hidden" value='200031' name='order_id' />
          <input type="hidden" value='340482' name='property_id' />
          <input type="hidden" name="no_plat_category" id="no_plat_category" value='' />
          <input type="hidden" value='change_various_statuses' name='form_type' />
          <div class="d-flex m-2">
            <div class="row">
              <div class="col-6">
                <button type="submit" name='buttontype' value='change' class="btn-teal  btn-warning">Change</button>
              </div>
              <div class="col-6">
                
                  <button type="submit" name='buttontype' value='change_no_notify' class="btn  btn-danger">Change Without Notifying client</button>
                
              </div>
            </div>
            <div class="ml-auto p-2">
              
                <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmationModal">Delete Order</button>
            </div>
            
            </div>
          </div>

        <!-- /.card-footer -->
        <input type="hidden" name="buttontype" id="changeStatusButtonType" value="">
      </form>

      <!-- Confirmation Modal -->
      <form class="d-flex m-4 form-horizontal" method="POST" id="delete-order-form" action="/delete_order_property/200031">
      <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete this order?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" form="delete-order-form" name="delete_order" value="delete_order" class="btn btn-danger">Delete</button>
            </div>
          </div>
        </div>
      </div>
    </form>

     <form>
      <div class="modal fade" id="validatePlat" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content" style="padding:0px;">
            <div class="modal-header">
              <h5 class="modal-title text-dark"><b> Plat Linkage Information</b></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Plat Linkage is mandatory if information is available. Confirm if the information is unavailable or available for a fee from the county.</p>
              <input type="hidden" name="no_plat_category" id="no_plat_category" value='' />
            </div>
            <div class="modal-footer">
              <button type="button" class="btn bg-success mr-3 text-white" id="info_not_available" >Info Not Available</button>
              <button type="button" class="btn bg-success mr-3 text-white" id="paid_county" >Paid County</button>
              <button type="button" class="btn bg-success text-white" id="close_modal" >Close</button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div class="modal fade" id="NoHoaModal" style="display: none; padding: 3px;">
      <div class="modal-dialog">
        <div class="modal-content" style="padding:0px;">
          <div class="modal-header">
            <h5 class="modal-title text-dark"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          <p>Reason why the suggestions don’t work:</p>
          <textarea name="no_hoa_explanation" class="form-control w-100 p-2 m-auto" rows="6" id="no_hoa_explanation"></textarea>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn-teal" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn-teal" >Save</button>
          </div>
        </div>
      </div>
   </div>
    <!-- hoa mention modal -->
    <div class="modal fade" id="displayHoaMentionPopup" style="display: none; padding: 3px;">
      <div class="modal-dialog">
          <div class="modal-content" style="padding:0px;">
              <div class="modal-header">
                  <h5 class="modal-title text-dark"><strong>HOA Details</strong></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  <p id="hoaModalMessage"></p>
              </div>
              <div class="modal-footer" style="display: flex; justify-content: space-between;">
                  <button type="submit" class="btn" style="background-color: #24a18e; color: white;">HOA is correct</button>
                  <button type="button" class="btn" data-dismiss="modal" style="background-color: #dc3545; color: white;">Review HOA</button>
              </div>
          </div>
      </div>
    </div>


    <!-- missing client files explanation modal -->
    <div class="modal fade" id="clientFilesExplanationPopup" style="display: none; padding: 3px;">
      <div class="modal-dialog modal-lg">
          <div class="modal-content" style="padding:0px;">
              <div class="modal-header">
                  <h5 class="modal-title text-dark"><strong>Please provide reasons why the following required documents are missing.</strong></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body" style="padding-left: 5%; padding-right: 5%;">
                <div id="clientFilesExplanationPopupBodySub">
                  <lable><strong>SUB HOA</strong></lable>
                  <table style="width:98%; margin-left: 2%;"></table>
               </div>
               <div id="clientFilesExplanationPopupBodyMaster">
                  <lable><strong>MASTER HOA</strong></lable>
                  <table style="width:98%; margin-left: 2%;"></table>
               </div>
               <div id="clientFilesExplanationPopupBodyHOA3">
                  <lable><strong>THIRD HOA</strong></lable>
                  <table style="width:98%; margin-left: 2%;"></table>
               </div>
              </div>
              <div class="modal-footer">
                  <button type="button" id="clientFilesExplanationPopupUpdateBtn" class="btn" style="background-color: #24a18e; color: white;">Save</button>
              </div>
          </div>
      </div>
    </div>


    </div>
  </div>
</section>



<script>

$('#posubStatusDropdown').on('change', function(){
  if (this.value == 5) {
    $('.po_resume_date_div').show();
  } else {
    $('.po_resume_date_div').hide();
  }
});


function validate_estoppel_status() {
  let estoppel_status = $('#posubStatusDropdown').val();

  if (estoppel_status == 5) {
    if ($('#po_resume_date').val() === '') {
      return false;
    }
  }

  return true;
}

const PERFORM_CLIENT_FILE_VALIDATION_STATUS = 1;

function displayHoaMentionPopup(data, e) {
    let hoasMentioned = data.HOAs_mentioned.map(hoa => `${hoa.HOA_name} (${hoa.contact_details})`).join('<br>');
    let hoasAssigned = data.HOAs_assigned.join('<br>');
    let message = `<strong>The client mentioned the HOAs as:</strong><br>${hoasMentioned}.<br><br><strong>Our assigned HOAs:</strong><br> ${hoasAssigned}<br><br><strong>Is that updated correctly?</strong>`;
    $('#hoaModalMessage').html(message);
    $('#displayHoaMentionPopup').modal('show');
    $('#displayHoaMentionPopup button[type="submit"]')
      .click(function() {
        handleSaveHoaMention(e);
    });

    $('#displayHoaMentionPopup button[data-dismiss="modal"]')
      .click(function() {
        handleCancelHoaMention();
    });
}

function addClientVerificationExpSelectBox(parent, explanations, currentMissingFile, availableFiles) {
  // Create and append select list
  const selectListLabel = document.createElement("label");
  selectListLabel.innerText = currentMissingFile.display_name;
  selectListLabel.style.cssText = "font-weight: 500;";

  const selectList = document.createElement("select");
  selectList.id = currentMissingFile.name;
  selectList.className = "form-control";

  const tr = document.createElement("tr");
  const td1 = document.createElement("td");
  const td2 = document.createElement("td");
  td1.style.cssText = "width: 30%;";
  td2.style.cssText = "width: 70%;";
  parent.append(tr);
  tr.append(td1);
  tr.append(td2);
  td1.append(selectListLabel);
  td2.append(selectList);

  // add the default option
  let option = document.createElement("option");
  option.selected = `selected`
  option.value = ``;
  option.text = `-- select --`;
  selectList.appendChild(option);

  option = document.createElement("option");
  option.value = `${currentMissingFile.name}: Not provided by the HOA`;
  const obj = explanations.find(o => `${o.missing_doc}: ${o.explanation}` === option.value);
  if (obj) {
      option.selected = "selected";
  }
  option.text = `Not provided by the HOA`;
  selectList.appendChild(option);

  option = document.createElement("option");
  option.value = `${currentMissingFile.name}: Waiting for the HOA`;
  const objWait = explanations.find(o => `${o.missing_doc}: ${o.explanation}` === option.value);
  if (objWait) {
      option.selected = "selected";
  }
  option.text = `Waiting for the HOA`;
  selectList.appendChild(option);

  // Create and append the options
  for (let i = 0; i < availableFiles.length; i++) {
      option = document.createElement("option");
      option.value = `${currentMissingFile.name}: Part of ${availableFiles[i].name}`;
      const obj = explanations.find(o => `${o.missing_doc}: ${o.explanation}` === option.value);
      if (obj) {
        option.selected = "selected";
      }
      option.text = `Part of ${availableFiles[i].display_name}`;
      selectList.appendChild(option);
  }
}


function displayClientVerificationPopup(explanations, missingFiles, availabeFiles, masterMissingFiles, hoa3MissingFiles, e, validateReport=false) {
  if (missingFiles) {
      let parent = $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodySub table')
      // make sure the section is visible
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodySub').show();
      // make sure that no existing dropdowns are left behind.
      parent.empty();
      for (const missingFile of missingFiles) {
        addClientVerificationExpSelectBox(parent, explanations.sub || [], missingFile, availabeFiles)
      }
  } else {
      // hide section
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodySub').hide();
  }

  if (masterMissingFiles) {
      let parent = $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyMaster table')
      // make sure the section is visible
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyMaster').show();
      // make sure that no existing dropdowns are left behind.
      parent.empty();
      for (const missingFile of masterMissingFiles) {
        addClientVerificationExpSelectBox(parent, explanations.master || [], missingFile, availabeFiles)
      }
  } else {
      // hide master section
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyMaster').hide();
  }

  if (hoa3MissingFiles) {
      let parent = $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyHOA3 table')
      // make sure the section is visible
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyHOA3').show();
      // make sure that no existing dropdowns are left behind.
      parent.empty();
      for (const missingFile of hoa3MissingFiles) {
        addClientVerificationExpSelectBox(parent, explanations.hoa3 || [], missingFile, availabeFiles)
      }
  } else {
      // hide section
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyHOA3').hide();
  }

  $('#clientFilesExplanationPopup').modal('show');

  $('#clientFilesExplanationPopup #clientFilesExplanationPopupUpdateBtn').click(() => {
      handleClientVerificationExplanation(e, validateReport=validateReport);
  });
}

function handleClientVerificationExplanation(e, validateReport=false) {
  let explanations = []
  const allSelectSub = $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodySub table select') || [];
  const allSelectMaster = $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyMaster table select') || [];
  const allSelectHOA3 = $('#clientFilesExplanationPopup #clientFilesExplanationPopupBodyHOA3 table select') || [];
  let allSelect = [];
  if (allSelectSub.length > 0) {
      allSelect = [...allSelect, ...allSelectSub]
  }
  if (allSelectMaster.length > 0) {
      allSelect = [...allSelect, ...allSelectMaster]
  }
  if (allSelectHOA3.length > 0) {
      allSelect = [...allSelect, ...allSelectHOA3]
  }
  for (const select of allSelect) {
      for (const opt of select.options) {
        if (opt.selected && opt.value) {
            explanations.push(opt.value)
            break
        }
      }
  }

  if (explanations.length !== allSelect.length) {
    sweetAlertFire('Please select explanation for all Missing Files', 'error', 2000)
  } else {
    saveClientVerificationExplanation(explanations, e, validateReport=validateReport)
  }
}

function saveClientVerificationExplanation(explanations, e, validateReport=false) {
  sweetAlertFire("Saving responses, please wait", "info", 2000)
  $('#clientFilesExplanationPopup #clientFilesExplanationPopupUpdateBtn').attr("disabled", "diabled");
  let expData = {};
  for (const explanation of explanations) {
      const item = explanation.split(':')
      expData[item[0].trim()] = item[1].trim();
  }
  const order_id = 200031;
  fetch(`/order/${order_id}/validate/client/files/`, {
      method: 'PUT',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(expData)
  })
  .then(response => response.json())
  .then(data => {
      $('#clientFilesExplanationPopup').modal('hide');
      sweetAlertFire('Responses saved successfully', 'info', 2000)
      if (validateReport === true) {
        validateClientFileOrderingReport(e);
      } else {
        submitFormFlow(e);
      }
  })
  .catch(error => {
      console.error('Error:', error);
      sweetAlertFire('Something Went wrong. Please contact Support', 'error', 3000)
      $('#clientFilesExplanationPopup #clientFilesExplanationPopupUpdateBtn').removeAttr("disabled");
  });
}


function validateClientFileOrderingReport(e) {
  const shouldPerformCheck = 0;
  if (shouldPerformCheck !== PERFORM_CLIENT_FILE_VALIDATION_STATUS) {
    return submitFormFlow(e);
  }
  sweetAlertFire("Validating report for client, please wait", "info", 2000)
  const order_id = 200031;
  fetch(`/order/${order_id}/validate/client/report/`, {
    method: 'GET',
  })
  .then(response => response.json())
  .then(data => {
    if (!data.valid) {
      sweetAlertFire("Please generate the HOA Report/Closing Report for this order before setting it to Complete.", "error", 5000)
      window.location.reload();
    } else {
      submitFormFlow(e);
    }
  })
  .catch(error => {
    sweetAlertFire("Something went Wrong, Please contact Support", "error", 3000)
    console.error('Error:', error);
  });
}

function validateClientSpecifiedFiles(e, validateReport=false) {
  const shouldPerformCheck = 0;
  if (shouldPerformCheck !== PERFORM_CLIENT_FILE_VALIDATION_STATUS) {
      return submitFormFlow(e);
  }
  const explanations = {};

  sweetAlertFire("Validating files, please wait", "info", 2000)
  const order_id = 200031;
  fetch(`/order/${order_id}/validate/client/files/`, {
      method: 'GET',
  })
  .then(response => response.json())
  .then(data => {
    if (!data.valid) {
      const existingExpMissingDocs = [
        ...(explanations.sub || []),
        ...(explanations.master || []),
        ...(explanations.hoa3 || []),
      ].map(item => item.missing_doc);

      const newExpMissingDocs = [
        ...(data.missing_files || []),
        ...(data.master_missing_files || []),
        ...(data.hoa_3_missing_files || [])
      ].map(item => item.name);

      if (existingExpMissingDocs.sort().join(',') !== newExpMissingDocs.sort().join(',')) {
        // collect reasons again only if new validation has some new files missing or added
        return displayClientVerificationPopup(
          explanations,
          data.missing_files,
          data.available_files,
          data.master_missing_files,
          data.hoa_3_missing_files,
          e,
          validateReport=validateReport
        );
      } else if (validateReport) {
        return validateClientFileOrderingReport(e);
      } else {
        return submitFormFlow(e);
      }
    } else {
      return submitFormFlow(e);
    }
  })
  .catch(error => {
    sweetAlertFire("Something went Wrong, Please contact Support", "error", 3000)
    console.error('Error:', error);
  });
}


function handleSaveHoaMention(e){
  $('#displayHoaMentionPopup').modal('hide');
  submitFormFlow(e);
}

function handleCancelHoaMention(){
  $('#displayHoaMentionPopup').modal('hide');
  location.reload();
}

function check_hoa_mention(changeStatusForm, e) {
  const order_id = 200031;
  fetch('/validate_client_hoa_mention/' + order_id, {
    method: 'POST',
    body: new FormData(changeStatusForm),
  })
    .then(response => response.json())
    .then(data => {
      if (data.bool) {
        displayHoaMentionPopup(data, e);
      } else {
        submitFormFlow(e);
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
};

const checkFinderPlat = async (e) => {
  const order_type = "3";
  if (![
        parseInt(0),
        parseInt(1),
        parseInt(3),
      ].includes(parseInt(order_type))) {
    submitFormFlow(e);
    return;
  }

  const property_id = 340482;
  const state = "AL";
  const isTeamLead = "True"

  if ((['FL', 'WA'].includes(state) &&  isTeamLead === "True") || !['FL', 'WA'].includes(state)) {
    let response = await fetch(`/check_plats/${property_id}`, {
        method: 'GET',
      });
      response = await response.json();
      if (response.plat_exists) {
        submitFormFlow(e);
      } else {
        $('#validatePlat').modal('show');
      }
  } else {
    submitFormFlow(e);
  }
}

function displayPopup(data) {
    $('#NoHoaModal .modal-title').text(data.message);

    $('#NoHoaModal').modal('show');

    $('#NoHoaModal button[type="submit"]').click(function() {
        handleSave(data.hoa_capture_type);
    });

    $('#popupModal button[data-dismiss="modal"]').click(function() {
        handleCancel();
    });
}

function handleSave(hoa_capture_type) {
  var explanationContent = $('#no_hoa_explanation').val();

  if ($.trim(explanationContent) === '') {
      alert('Please provide a valid explanation before submitting.');
      return;
  }

  $('<input>').attr({
      type: 'hidden',
      name: 'no_hoa_explanation',
      value: explanationContent
  }).appendTo('#changeStatusForm');

  $('<input>').attr({
      type: 'hidden',
      name: 'hoa_capture_type',
      value: hoa_capture_type
  }).appendTo('#changeStatusForm');

  $('#changeStatusForm').submit();
}

function handleCancel() {
    $('#popupModal').modal('hide');
}
</script>

<script>
$(document).ready(function() {
  
  const order_type = 3

  if (parseInt(order_type) === parseInt(5)) {
    const hidden_statuses = ["10", "11",
                             "15", "12"];

    $.each(hidden_statuses, function(index, value) {
      let option = $(`#orderStatusDropdown option[value=${value}]`);
      option.prop('disabled', true);
      option.hide();
    });
  }
});
</script>

<script>
  let order_status_to_ignore_for_mortgage_payoff = []
  order_status_to_ignore_for_mortgage_payoff = order_status_to_ignore_for_mortgage_payoff.map(item=>item.toString())

  let orderStatusSelect = document.getElementById('orderStatusDropdown');
  orderStatusSelect.querySelectorAll('option').forEach(function(option) {
  if (order_status_to_ignore_for_mortgage_payoff.includes(option.value)) {
    option.remove();
  }
});
</script>

<script>
  $(document).ready(function(){
    let ignoreCloseMessage = false;
    $('#openModal').click(function(){
      $('#validatePlat').modal('show');
    });

    $('#info_not_available, #paid_county').click(function(){
      $('#no_plat_category').val(this.id);
      $('#validatePlat').modal('hide');
      ignoreCloseMessage = true;
      submitFormFlow(null);
    });
    const oldFinderSubStatus = parseInt("12") || null;
    let finderStatusDropdown = document.getElementById('findersubStatusDropdown');

   $('#close_modal').click(function(){
      sweetAlertFire("Finder sub status can't change to 'Finder Analysis Complete' without plat linkage or selecting a validation option.", 'error', 5000)
        ignoreCloseMessage = true;
        if (finderStatusDropdown){
          finderStatusDropdown.value = oldFinderSubStatus
        }
      $('#validatePlat').modal('hide');
    });

    $('#validatePlat').on('hidden.bs.modal', function () {
      if (!ignoreCloseMessage) {
        if (finderStatusDropdown){
          finderStatusDropdown.value = oldFinderSubStatus
        }
        sweetAlertFire("Finder sub status can't change to 'Finder Analysis Complete' without plat linkage or selecting a validation option.", 'error', 5000)
      }
      });

  });
</script>

<script>
  var els = document.getElementsByClassName("status");
  for (i = 0; i < els.length; i++) {
      els[i].value = els[i].getAttribute('value');
  }
</script>


<script>
    const changeStatusForm = document.getElementById('changeStatusForm');
    let orderStatusDropdown = document.getElementById('orderStatusDropdown');
    const hoaPaymentStatusDropdown = document.getElementById('hoaPaymentStatusDropdown');
    const posubStatusDropdown = document.getElementById('posubStatusDropdown');
    let oldPoSubStatus = parseInt("None")
    if (hoaPaymentStatusDropdown != null){
      orderStatusDropdown = hoaPaymentStatusDropdown
    }
    // jinja order_required.complete_for_ocr into js array
    var completeForOCR = null
    var order_available = false
    var validate_url = ''


    const property_id = 340482

    
      order_available = true
      completeForOCR = [4, 18, 19, 20, 21, 9];
      validate_url = `/validate_documents/340482/200031`
    

    changeStatusForm.addEventListener('submit', e => {
      e.preventDefault();
      document.getElementById('changeStatusButtonType').value = e.submitter.value;
      if (order_available) {

        if (!validate_estoppel_status()) {
          sweetAlertFire('Save the resume date to change to PO Waiting', 'error', 2000)
          return
        }

        let finderStatusDropdown = document.getElementById('findersubStatusDropdown');
        let oldFinderStatus = parseInt("12") || null;

        let newFinderStatus = null;
        if (finderStatusDropdown != null){
          newFinderStatus = parseInt(finderStatusDropdown.value);
        }

        let newPoSubStatus = null;
        if (posubStatusDropdown) {
          newPoSubStatus = parseInt(posubStatusDropdown.value);
        }
        let newOrderStatus = null;
        if (orderStatusDropdown) {
          newOrderStatus = parseInt(orderStatusDropdown.value);
        }
        const oldPoSubStatus2 = parseInt("4") || null;
        const oldOrderStatus = parseInt("1");
        const shouldPerformCheck = parseInt("0");
        if (newFinderStatus === 12 && oldFinderStatus != newFinderStatus) {
          // hoa mention check
          check_hoa_mention(changeStatusForm, e);
        } else if (([12, 4].includes(newPoSubStatus)) && oldPoSubStatus2 !== newPoSubStatus && shouldPerformCheck === PERFORM_CLIENT_FILE_VALIDATION_STATUS) {
          // validate files for po status
          validateClientSpecifiedFiles(e)
        } else if (([9].includes(newOrderStatus)) && oldOrderStatus !== newOrderStatus && shouldPerformCheck === PERFORM_CLIENT_FILE_VALIDATION_STATUS) {
          // validate files for order status : doc ready
          validateClientSpecifiedFiles(e)
        } else if (([4].includes(newOrderStatus)) && oldOrderStatus !== newOrderStatus && shouldPerformCheck === PERFORM_CLIENT_FILE_VALIDATION_STATUS) {
          // validate files for order status : complete and process the report validation
          validateClientSpecifiedFiles(e, validateReport=true)
        }  else if ( newFinderStatus == 4 && oldFinderStatus != newFinderStatus) {
          // check if plat present in the property
          checkFinderPlat(e)
        } else {
          submitFormFlow(e);
        }
      }
    })

  function submitFormFlow(e) {
    let oldStatus = parseInt("1");
    let orderId = parseInt("200031");
    let newStatus = parseInt(orderStatusDropdown.value);
    let excludeDocumentTypeToValidate = []
    let documentsReadyStatusValue = parseInt("9");

    if((oldStatus == newStatus) && posubStatusDropdown) {
        if (oldPoSubStatus != posubStatusDropdown.value){
          validateSendgridAttachments(orderId, posubStatusDropdown.value, changeStatusForm)
        } else{
          changeStatusForm.submit();
        }
      } else if (newStatus == 11){

            fetch('/validate_no_hoa_action/' + property_id, {
              method: 'POST',
              body: new FormData(changeStatusForm)
            })
                .then(response => response.json())
                .then(data => {
                  if (data.bool) {
                    displayPopup(data);
                  } else {
                    changeStatusForm.submit();
                  }
                })
                .catch(error => {
                  console.error('Error:', error);
                });

      }

      else if (!completeForOCR.includes(newStatus)) {
        changeStatusForm.submit();
      }
      else {
        if (e) {
          e.submitter.disabled = true;
        }


        if (newStatus == documentsReadyStatusValue) {
          excludeDocumentTypeToValidate.push('HOA_REVIEW')
          excludeDocumentTypeToValidate.push('RESALE_CERT_APPROVAL')
        }

        sweetAlertFire('Please wait until we validate documents', 'info', 1500)
        validateAllDocumentsAreUploaded(validate_url, changeStatusForm, excludeDocumentTypeToValidate.join(','), false, '&bypass_invoice_validation=true')
      }
  }
</script>

<script>
  $(document).ready(function() {
    const reasonBlock = $('#reason-block');
    const orderStatus = 1;
    const WAITING_FOR_CLIENT_CONFIRMATION = 14
    console.log(WAITING_FOR_CLIENT_CONFIRMATION)
    document.getElementById('reason').selectedIndex = 0;
    reasonBlock.hide();

    if (orderStatus !== WAITING_FOR_CLIENT_CONFIRMATION) {
      reasonBlock.hide();
    } else {
      reasonBlock.show();
      let confirmation_reason = 0
      if (confirmation_reason != null) {
        $('#reason').val(confirmation_reason);
      }
    }

    $('#orderStatusDropdown').on('change', function() {
      const selectedValue = $(this).val();
      let reason = $('#reason-block');

      if ( parseInt(selectedValue) === WAITING_FOR_CLIENT_CONFIRMATION) {
        reason.fadeIn(750);

        $("#reason").css({
          "box-shadow": "0 0 10px #28B79D",
        });

        setTimeout(function () {
          $("#reason").css({
            "box-shadow": "none",
            "background-color": "transparent",
          });
        }, 5000);

      } else{
        reason.hide()
      }
    });
  });
</script>


<script>

  function validateSendgridAttachments(orderId, poStatus, form) {
    if (oldPoSubStatus == poStatus){
      form.submit();
      return
    }
    if (poStatus != 12){
      form.submit();
      return
    }
    const order_id = 200031;
    fetch('/validate_sendgrid_attachments/' + order_id, {
      method: 'GET',
    })
      .then(response => {
        // if response 200, submit form
        if (response.status === 200) {
          form.submit();
        } else {
          // if response 400, show error message
          response.json().then(data => {
            let warningMessage = data.message;

            Swal.fire({
                title: "Missing attachment",
                text: warningMessage,
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Proceed",
                cancelButtonText: "Review files",
              }).then((result) => {
                if (result.isConfirmed) {
                  Swal.fire({
                    title: "Proceeding!",
                    text: "Changing status.",
                    icon: "success"
                  });
                  form.submit();
                }else{
                  sweetAlertFire('Please review files', 'info', 1500)
                  window.location.reload();
                }
              });


          });
        }
      })
      .catch(error => {
        console.error('Errorss:', error);
        sweetAlertFire('Something went wrong', 'error', 1500)
        window.location.reload();
      });
  }
</script>
           </div>
            
        </div>

      

    </div>
  </section>
</div>


<script src="/static/assets/js/documents/index.js"></script>






    <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div>
    &copy; <a target="_blank" rel="noopener noreferrer" href="https://rexera.com">Rexera</a>
    </div>

    <div class="float-right d-none d-sm-inline-block">
      Ph: 415-236-2577 <br>
      
        Fax: 765-374-0795 <br>
      
      Address: 515 E Main St, #16, Muncie, IN 47305  <br>
    </div>
  </footer> 

      <!-- Control Sidebar -->
      <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
      </aside>
      <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->

    <!-- Specific Page JS goes HERE  -->
    
    <script>

          const fetchBusinessDateForOffset = async (bdays) => {
              if (!bdays) {
                  console.error("Input value is null or empty");
                  return;
              }

              const url = "/documents/get_business_date_for_offset";
              const data = {
                  days_offset: bdays
              };

              const options = {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(data),
              };
              try {
                const response = await fetch(url, options);
                const {business_date} = await response.json();
                return business_date;
              } catch (error) {
                console.error("An error occurred while fetching business date:", error);
                alert("An error occurred while fetching business date");
              }
          }


      document.addEventListener("DOMContentLoaded", function (event) {
        var disable_pages = document.querySelectorAll("[disable-page]");
        disable_pages.forEach(function (disable_page) {
          disable_page.removeAttribute("onclick");
          disable_page.querySelector("a").style.cursor = "not-allowed";
          disable_page
            .querySelector("a")
            .setAttribute("data-toggle", "tooltip");
          disable_page.querySelector("a").setAttribute("data-placement", "top");
          disable_page
            .querySelector("a")
            .setAttribute("title", "Contact Admin");
        });
      });
    </script>

    <script>
      $(document)
        .ready(function () {
          $("body").popover({
            html: true,
            selector: '[data-toggle="popover"]',
            title: function () {
              return `${$(this).data(
                "title",
              )} <a href="#" class="close">&times;</a>`;
            },
            content: function () {
              var contentId = $(this).data("content-id");
              let content = "";
              if (contentId) {
                content = $($("#" + contentId).html());
              } else {
                content = $(this).data("content");
              }

              return content;
            },
          });
        })
        .on("shown.bs.popover", function (eventShown) {
          var $popup = $("#" + $(eventShown.target).attr("aria-describedby"));
          $popup.find("a.close").click(function (e) {
            $popup.popover("hide");
          });
        });
    </script>

    <script>
      function fileShowCount(input_file_element, origin = "fileSection") {
        var file_count = input_file_element.files.length;
        const maxSize = 30; // for sending attachments

        // Check total size
        let totalSize = 0;
        for (let i = 0; i < file_count; i++) {
          let fileSize = input_file_element.files[i].size / 1000000; // Convert size from bytes to MB
          totalSize = totalSize + fileSize;
          if (totalSize > maxSize) {
            alert(
              "This file is too big to be emailed (>30MB). Please break it up into smaller files.",
            );
            input_file_element.value = "";
            file_count = 0;
          }
        }

        let file_count_string = file_count + " file(s)";
        var label_element = input_file_element.nextElementSibling;
        // split innerhtml with --
        if (
          input_file_element.getAttribute("data-display-label-type") ==
          "filename"
        ) {
          var file_name_string = input_file_element.files[0].name;
          label_element.innerHTML = file_count_string + "--" + file_name_string;
        } else {
          var label_text = label_element.innerHTML.split("--");
          // style="border-radius: 50%"
          label_element.innerHTML =
            label_text[0] +
            "--" +
            '<span class="badge badge-warning rounded">' +
            file_count_string +
            "</span>";
        }
      }
    </script>
    <!-- Select2 -->

    <script>
      // Animate accordion chevron button when accordion is pressed
      const accordion_buttons =
        document.getElementsByClassName("btn-accordion");
      for (let i = 0; i < accordion_buttons.length; i++) {
        const button = accordion_buttons[i];
        button.addEventListener("click", function () {
          var icon = this.querySelector(".animate-icon");
          icon.classList.toggle("rotate");
        });
      }

      // Trigger accordions to be open only the first time the page loads
      window.onload = function () {
        if (localStorage.getItem("hasCodeRunBefore") == null) {
          const accordions = document.getElementsByClassName("accordion-body");
          for (let i = 0; i < accordions.length; i++) {
            const accordion = accordions[i];
            accordion.classList.add("show");
          }
          localStorage.setItem("hasCodeRunBefore", true);
        }
      };
    </script>

    <script>
      function loadDrafts(comment_instance, key) {
        let currentTime = new Date().getTime();

        let clientDraft = JSON.parse(localStorage.getItem(key));

        if (clientDraft && currentTime - clientDraft.timestamp <= 300000) {
          comment_instance.val(clientDraft.content);
        } else if (clientDraft) {
          localStorage.removeItem(key);
        }
      }

      function deleteOldDrafts() {
        let currentTime = new Date().getTime();

        for (let i = 0; i < localStorage.length; i++) {
          let key = localStorage.key(i);

          if (
            key.startsWith("client_comments_") ||
            key.startsWith("team_chat_")
          ) {
            let item = JSON.parse(localStorage.getItem(key));
            if (
              item &&
              item.timestamp &&
              currentTime - item.timestamp > 86400000
            ) {
              // 24 hours = 86400000 ms
              localStorage.removeItem(key);
            }
          }
        }
      }

      function saveClientNameAndCommentChecked(
        request_type,
        property_id,
        order_id,
      ) {
        $.ajax({
          type: "POST",
          url: `/property/${property_id}/${order_id}/save/client_name_and_comment_checked`,
          data: {
            request_type: request_type,
          },
          success: function (response) {
            sweet_alert("success", `${request_type.replace("_", "")} checked`);
          },
          error: function (e) {
            alert(`An error occurred and your action was not successful: ${e}`);
          },
        });
      }

      function handleClick(selector, requestType) {
        $(selector).on("click", function () {
          const $this = $(this);
          $this.attr("disabled", true);
          const propertyId = $this.data("property_id");
          const orderId = $this.data("order_id");
          saveClientNameAndCommentChecked(requestType, propertyId, orderId);
        });
      }

      handleClick("#comment_checked", "comment");
      handleClick("#client_name_check", "client_name");

      $(".has_dropdown").on("click", function (event) {
        $(this).parent().toggleClass("show-dropdown hide-dropdown");
      });
    </script>
    
    <script src="https://ihoa-workflow-flask-assets-staging.s3.amazonaws.com/static/js/timeMe.js"></script>

    <script>
      let user_ip = null;

      $(document).ready(function () {
        $.getJSON("https://api.ipify.org?format=json", function (data) {
          user_ip = data.ip
        });
      });

      let dataToTrack = {"order_id": 200031, "path": "/change_status/340482/200031?", "property_id": 340482, "userid": 2527}

      TimeMe.initialize({
        currentPageName: "/change_status/340482/200031?",
        idleTimeoutInSeconds: 10
      });





      window.onbeforeunload = function (event) {
        let timeSpentOnPage = TimeMe.getTimeOnCurrentPageInSeconds();
        dataToTrack['time_spent_on_page'] = timeSpentOnPage
        dataToTrack['user_ip'] = user_ip
        navigator.sendBeacon('/userTimeTrackEndpoint', JSON.stringify(dataToTrack))
      };
    </script>
     

    <script>
      // singular initialization of sweet alert function that will be called in multiple templates
      function sweet_alert(icon, title) {
        var Toast = Swal.mixin({
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timer: 5000,
        });

        Toast.fire({
          icon,
          title,
        });
      }
    </script>


<script>
  // This function clears the session token and other related data from localStorage
  function clearSessionStorage() {
    const userId = "2527";
    const tokenKey = "session_token_" + userId;
    const sessionExpireKey = "session_expire_" + userId;
    console.log('Clearing session token');

    localStorage.removeItem(tokenKey);
    localStorage.removeItem(sessionExpireKey);
  }

  document.addEventListener('DOMContentLoaded', function() {
      const logoutLinks = document.querySelectorAll('.logoutLink');
      logoutLinks.forEach(link => {
          link.addEventListener('click', clearSessionStorage);
      });
  });
</script>

  </body>
</html>